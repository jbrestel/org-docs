#+STARTUP: indent
* TODO EDA Updates for Steve  <2021-06-14 Mon>
+ AttributeGraph table
  1. ordinal_values -> ordered_values
  2. in is_merge_key and is_repeated i am seeing null where in the other booleans i see 0.  i think we should be consistent, and use 0
  3. for dates, distinct_values_count is 0.
  4. for many number variables, precision is null.  i don't think it should ever be.

* TODO Can do these now
1. (Wojtek) units and scale (owl file or ISA??)
2. (Jay) validate annotation properties
3. (JohnB) createEntityGraph and dropEntityGraph sqls seem not to be working
4. (JohnB) eda schema instead of apidb
7. (JohnB) Binary inference has priority over ordinal
8. (Jay) incorporate the geohash file into the samples or better calculate automatically whenever we have latitude/long

* Unresolved Questions
1. Should study be new entity type?
   + may be needed for xstudy comparisons
2. can we use lat/long to make geohash on the fly
3. Units for cross study comparisons should convert to base unit
4. do we need an additional plugin to uniion all studies and create a big "Meta study"??

* Projects
** ClinEpi
+ feature site from cloned instance
+ dev site from rm41910 instance
+ workflow development in progress
+ once backedn is stable, can begin loading all studies
** Microbiome
+ some possible performance issues with EC levels / Pathways for functional shotgun data
+ Need analysis service (phase2 deliverable)
+ metabolite data
+ port of shiny applications
** Genomics
** MapVEU
*** Loading issues
1. Load 2 studies (Phenotype/Genotype) from ISA dumps.  Create plugin to make x study comparison with Units in base unit
2. Map Data Mixed units within studies?

** Cross study Comparison (and cross project)
+ same use case BobM has for the Map Applicatoin??
** DIY
+ DONE Refactoring of ClinEpi preprocessing scripts
+ potentially some shared code (ClinEpi/Mbio)
  + input for mbio is a biom file (table of otu and table of sample details)
  + schema will be shared (entity graph)
+ Need to update User Datasets to work with eda schema
+ how to do inserts? can we reuse the existing plugins?
  + mbio will need different reader due to the biom file input
+ what about ontology dependencies?


* Preprocessing
+ All entities need ontology term
  + Household,Participant,Observation, ...
+ can we use the owl file in place of the ontologymapping.xml?
  + can we get rid of the ontologymapping.xml entirely??
  
* Workflow
+ Replaced InsertInvestigation and Tuning Table steps with the EDA Plugins Above
+ Each dataset should be able to add ontologysynonyms for entitytypes
+ Need new step to make the dowload files
  + Need to retain any custom code for big merged file
+ apidb.study and apidb.entitytype have internal_abbrev columns which are used for naming of dataset specific tables
  
* Plugins
1. InsertEntityGraph :: This plugin reads the ISA(Tab or Simple) files and populates normalized tables representing the EntityGraph
   + GUS::Model::ApiDB::Study;
   + GUS::Model::ApiDB::EntityType;
   + GUS::Model::ApiDB::ProcessType;
   + GUS::Model::ApiDB::EntityAttributes;
   + GUS::Model::ApiDB::ProcessAttributes;
   + GUS::Model::ApiDB::AttributeUnit;
   + GUS::Model::ApiDB::ProcessTypeComponent;
2. LoadAttributesFromEntityGraph :: This plugin reads the Values from the EntityGraph Table and makes a big tall table (key/values).  We calculates stats at this point for each variable/dataset/entityType;  THe Attribute table is populated for the LEAF nodes in our "AttributeGraph";  We require the owl file at this point as a sanity check
   + GUS::Model::ApiDB::Attribute
   + GUS::Model::ApiDB::AttributeValue
3. LoadEntityTypeAndAttributeGraphs :: Populate tables for parent-child relationships (EntityTypes and Attributes);  There is only one owl file per dataset.  The AttributeGraph table here does not care about EntityType;  AttributeGraph also stores annotation properties from the owl file
   + GUS::Model::ApiDB::AttributeGraph
   + GUS::Model::ApiDB::EntityTypeGraph
4. LoadDatasetSpecificEntityGraph :: Join Attribute (LEAF) with AttributeGraph
   + GUS::Model::ApiDB::AttributeValue_${studyId}_${EntityTypeId}
   + GUS::Model::ApiDB::Ancestors_${studyId}_${EntityTypeId}
   + GUS::Model::ApiDB::AttributeGraph_${studyId}_${EntityTypeId}

* Popset Sequences
+ Workflow
  + Do we continue to do alignments to family?
+ Presentation
  + Leave as WDK Records?
  + Integrate into EDA?
    + load as entitygraph (json)
    + subset would be ok for things like Geographic Location
    + other graphs?
+ 
* 
